<!DOCTYPE html>
<html>
<head>
  <title>Country Province/City Report</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <h2>Country Report</h2>
  <input type="text" id="countryInput">
  <button onclick="generateReport()">Search</button>

  <div id="result"></div>

  <script>
    function generateReport() {
      var xhttp = new XMLHttpRequest();
      xhttp.open("GET", "ITC5202-dataset.xml", false);
      xhttp.send();
      var xmlDoc = xhttp.responseXML;

      var input = document.getElementById("countryInput").value.trim().toLowerCase();
      var countries = xmlDoc.getElementsByTagName("country");

      var output = "";

      for (var i = 0; i < countries.length; i++) {
        var country = countries[i];
        var countryName = country.getElementsByTagName("name")[0].textContent;

        if (countryName.toLowerCase().startsWith(input)) {
          output += "<h3>" + countryName + "</h3>";

          var provinces = country.getElementsByTagName("province");
          if (provinces.length > 0) {
            output += "<table><tr><th>Province Name</th><th>Local Name</th><th>Population (2011)</th><th>No of Cities</th></tr>";

            for (var j = 0; j < provinces.length; j++) {
              var prov = provinces[j];
              var provName = prov.getElementsByTagName("name")[0].textContent;
              var localName = prov.getElementsByTagName("localname")[0]?.textContent || "-";

              var pop2011 = "-";
              var pops = prov.getElementsByTagName("population");
              for (var p = 0; p < pops.length; p++) {
                if (pops[p].getAttribute("year") === "2011") {
                  pop2011 = pops[p].textContent;
                  break;
                }
              }

              var cityCount = prov.getElementsByTagName("city").length;

              output += "<tr><td>" + provName + "</td><td>" + localName + "</td><td>" + pop2011 + "</td><td>" + cityCount + "</td></tr>";
            }

            output += "</table><br>";
          } 
          else 
          {
            // No provinces - display cities directly
            var cities = country.getElementsByTagName("city");
            if (cities.length > 0) {
              output += "<table><tr><th>City Name</th><th>Population (2011)</th></tr>";
              for (var c = 0; c < cities.length; c++) {
                var city = cities[c];
                var nameTag = city.getElementsByTagName("name")[0];
                var pop2011 = "-";
                var pops = city.getElementsByTagName("population");

                for (var p = 0; p < pops.length; p++) {
                  if (pops[p].getAttribute("year") === "2011") {
                    pop2011 = pops[p].textContent;
                    break;
                  }
                }

                output += "<tr><td>" + nameTag.textContent + "</td><td>" + pop2011 + "</td></tr>";
              }
              output += "</table><br>";
            } else {
              output += "<p>No provinces or cities available.</p>";
            }
          }
        }
      }

      document.getElementById("result").innerHTML = output || "<p>No matching country found.</p>";
    }
  </script>

</body>
</html>
